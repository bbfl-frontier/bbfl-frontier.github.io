---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageHeader from '../components/PageHeader.astro';
import fs from 'fs';
import path from 'path';

const officials = JSON.parse(fs.readFileSync(path.join(process.cwd(), 'data/officials.json'), 'utf-8'));

// Check if image file exists
const imageExists = (imagePath) => {
  const publicPath = path.join(process.cwd(), 'public', imagePath);
  return fs.existsSync(publicPath);
};

// Group officials by role
const groupedOfficials = officials.reduce((acc, official) => {
  if (!acc[official.role]) acc[official.role] = [];
  acc[official.role].push(official);
  return acc;
}, {});

const roleOrder = ['Founder', 'Commentator', 'Judge', 'Referee', 'Doctor', 'Timekeeper', 'Inspector'];
---

<BaseLayout
  title="Officials"
  description="Meet the officials of the Blood & Bourbon Fight League. Learn about our founders, judges, referees, and medical staff who ensure fair competition."
>
  <PageHeader title="BBFL Officials" subtitle="Meet the team behind the Blood & Bourbon League" />

  <section class="py-16 bg-tan">
    <div class="container mx-auto px-4 max-w-6xl">
      {roleOrder.map(role => {
        const roleOfficials = groupedOfficials[role];
        if (!roleOfficials || roleOfficials.length === 0) return null;

        return (
          <div class="mb-16">
            <h2 class="text-3xl font-black text-bourbon mb-8 border-b-4 border-bourbon pb-2 inline-block">
              {role}{roleOfficials.length > 1 ? 's' : ''}
            </h2>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {roleOfficials.map(official => {
                const hasImage = official.image && imageExists(official.image);
                return (
                  <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-bourbon hover:shadow-2xl transition-all">
                    <div class="aspect-square bg-gray-200 relative overflow-hidden">
                      {hasImage ? (
                        <img
                          src={official.image}
                          alt={`${official.firstName} ${official.lastName}`}
                          class="w-full h-full object-cover"
                        />
                      ) : (
                        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-bourbon to-blood">
                          <div class="text-6xl font-black text-white opacity-20">
                            {official.firstName[0]}{official.lastName ? official.lastName[0] : ''}
                          </div>
                        </div>
                      )}
                    </div>

                  <div class="p-6">
                    <h3 class="text-2xl font-black text-bourbon mb-1">
                      {official.firstName}{official.lastName ? ' ' + official.lastName : ''}
                    </h3>
                    <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-3">
                      {official.role}
                    </p>

                    {official.bio && (
                      <p class="text-sm text-gray-700 leading-relaxed">
                        {official.bio}
                      </p>
                    )}

                    {!official.active && (
                      <div class="mt-4 inline-block px-3 py-1 bg-red-100 text-red-800 text-xs font-bold rounded-full">
                        INACTIVE
                      </div>
                    )}
                  </div>
                </div>
                );
              })}
            </div>
          </div>
        );
      })}
    </div>
  </section>
</BaseLayout>
